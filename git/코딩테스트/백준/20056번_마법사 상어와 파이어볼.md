# . 20056번 : 마법사 상어와 파이어볼

- [20056번](https://www.acmicpc.net/problem/20056)



```c++
#include <iostream>
#include <cmath>
#include <vector>

using namespace std;

int N, M, K;
int r, c, m, s, d;
int dir[8][2] = { {-1,0}, {-1,1}, {0,1}, {1,1}, {1,0}, {1,-1}, {0,-1}, {-1,-1} };

vector<vector<int>> board;
vector<vector<int>> fireball;
vector<vector<int>> tmp_fireball;
vector<int> list;

vector<int> IsRange(int x, int y) {
	if (x >= 0 && y >= 0 && x < N && y < N) return vector<int> {x, y};
	if (x < 0) { x += N; }
	else if (x >= N) { x -= N; }
	if (y < 0) { y += N; }
	else if (y >= N) { y -= N; }
	return vector<int> {x, y};
}

void MoveFireball() {
	int nextX, nextY, mm, ss, dd;
	//M = fireball.size(); //M은 계속 변한다. 늘어날 수 있다.
	for (int i = 0; i < M; i++) {
		mm = fireball[i][2];
		if (mm == 0) continue;
		nextX = fireball[i][0];
		nextY = fireball[i][1];
		ss = fireball[i][3];
		dd = fireball[i][4];
		for (int j = 0; j < ss; j++) {
			nextX += dir[dd][0];
			nextY += dir[dd][1];
			vector<int> position = IsRange(nextX, nextY); //올바르다면 그 좌표가 돌아올거고, 아니면 변환되어 올것
			nextX = position[0];
			nextY = position[1];
		}
		fireball[i][0] = nextX;
		fireball[i][1] = nextY;
	}
}

void Action() {
	//list를 가지고 연산한다.
	int sum_m=0;
	int sum_s=0;
	int remain = fireball[list[0]][4] % 2;
	int _case = 0; //일단 0,2,4,6으로 가정
	int dir_case[2][4] = { {0, 2, 4, 6}, {1, 3, 5, 7} };
	int cnt = list.size();
	for (int i = 0; i < cnt; i++) {
		sum_m += fireball[list[i]][2];
		tmp_fireball[list[i]][2] = 0; //질량 0으로 만들어주기
		sum_s += fireball[list[i]][3];
		if (fireball[list[i]][4] % 2 != remain) _case = 1; //하나라도 홀짝이 다르면 1,3,5,7로 간다.
	}
	sum_m = sum_m / 5;
	sum_s = sum_s / cnt;

	for (int i = 0; i < 4; i++) {

		vector<int> element{fireball[list[0]][0], fireball[list[0]][1], sum_m, sum_s, dir_case[_case][i]};
		tmp_fireball.push_back(element);
	}
}

int main(void) {
	cin >> N >> M >> K; //N-board크기, M-파이어볼개수, K-활동횟수
	board.resize(N, vector<int>(N, 0));
	for (int i = 0; i < M; i++) {
		vector<int> element(5, 0);
		fireball.push_back(element);
	}
	for (int i = 0; i < M; i++) {
		cin >> r >> c >> m >> s >> d;
		board[r - 1][c - 1] = i + 1;
		fireball[i][0] = r - 1;
		fireball[i][1] = c - 1;
		fireball[i][2] = m;
		fireball[i][3] = s;
		fireball[i][4] = d;
	}

	for (int i = 0; i < K; i++) {
		// 각자의 파이어볼이 이동, board와 fireball 모두 갱신
		MoveFireball();
		tmp_fireball.clear();
		tmp_fireball = fireball;
		M = tmp_fireball.size();
		
		vector<int> tmp(M, 0); //0이면 겹치는 좌표 검사 안했다는 뜻
		for (int j = 0; j < M; j++) { //비교 대상이 되는 fireball은 j
			if (tmp[j] == 1 || fireball[j][2]==0 ) continue; //겹치는 좌표 검사한 애는 건너뛰기, 질량 0이면 건너뛰기
			list.clear(); //현재 좌표와 겹치는 좌표 담는 리스트
			tmp[j] = 1;
			list.push_back(j);
			for (int k = j; k < M; k++) { //계속 바뀌며 비교하는 것은 k
				if (tmp[k] == 1 || fireball[k][2] == 0) continue;
				if (fireball[j][0] == fireball[k][0] && fireball[j][1] == fireball[k][1]) {
					tmp[k] = 1;
					list.push_back(k);
				}
			}
			// list를 가지고 일해야한다.
			if (list.size() > 1) {
				Action();
				tmp.push_back(0); tmp.push_back(0); tmp.push_back(0); tmp.push_back(0);
				
			}
		}
		fireball.clear();
		fireball = tmp_fireball;
		M = fireball.size();
	}

	int answer = 0;
	for (int i = 0; i < M; i++) {
		if (fireball[i][2] == 0) continue;
		answer += fireball[i][2];
	}
	cout <<answer << endl;


	return 0;
}
```

